#!/usr/bin/env python3
import re
import sys
import os

def test_regex(log_path, pattern):
    try:
        with open(log_path, 'r') as f:
            for line in f:
                if re.search(pattern, line):
                    print(f"MATCH: {line.strip()}")
    except FileNotFoundError:
        print(f"Error: Log file {log_path} not found")

if __name__ == '__main__':
    if '--help' in sys.argv:
        print("Usage: fail2ban-regex [OPTIONS] <log-file> <pattern>")
        print("Offline regex testing tool")
        sys.exit(0)
    
    args = [a for a in sys.argv[1:] if not a.startswith('-')]
    if len(args) < 2:
        print("Error: Requires log file and pattern arguments")
        sys.exit(1)
    
    log_path, pattern = args[0], args[1]
    if not os.path.exists(log_path):
        print(f"Error: File {log_path} does not exist")
        sys.exit(1)
    
    test_regex(log_path, pattern)
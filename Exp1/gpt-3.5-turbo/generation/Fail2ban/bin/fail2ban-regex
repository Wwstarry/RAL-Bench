#!/usr/bin/env python3
import sys
import re
import tempfile
import os

def print_help():
    print("""fail2ban-regex - minimal stub

Usage:
  fail2ban-regex <logfile> <failregex>

This tool tests log lines against a failregex pattern.
No real banning or daemon operations are performed.
""")

def main():
    if '--help' in sys.argv or len(sys.argv) != 3:
        print_help()
        sys.exit(0)

    logfile = sys.argv[1]
    failregex = sys.argv[2]

    try:
        pattern = re.compile(failregex)
    except re.error as e:
        print(f"Invalid regex pattern: {e}")
        sys.exit(1)

    try:
        with open(logfile, 'r', encoding='utf-8') as f:
            lines = f.readlines()
    except Exception as e:
        print(f"Error reading logfile: {e}")
        sys.exit(1)

    matched = 0
    total = 0
    for line in lines:
        total += 1
        if pattern.search(line):
            print(f"Matched: {line.strip()}")
            matched += 1

    print(f"\nSummary: {matched} / {total} lines matched.")

if __name__ == '__main__':
    main()
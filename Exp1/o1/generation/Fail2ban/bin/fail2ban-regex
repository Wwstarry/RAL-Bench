#!/usr/bin/env python3

"""
Minimal fail2ban-regex script demonstration.
Safely test regex against a sample log file offline.
No real banning or server interaction.
"""

import sys
import re

def show_help():
    print("Usage: fail2ban-regex [LOGFILE] [REGEX]\n")
    print("Options:")
    print("  --help   Show this help message and exit")
    print("\nThis script performs an offline regex match on the specified logfile.")

def main():
    if "--help" in sys.argv or len(sys.argv) < 3:
        show_help()
        return

    logfile = sys.argv[1]
    pattern = sys.argv[2]

    try:
        regex = re.compile(pattern)
    except re.error as e:
        print(f"Error compiling regex: {e}")
        sys.exit(1)

    try:
        with open(logfile, 'r') as f:
            matches = 0
            for line in f:
                if regex.search(line):
                    matches += 1
            print(f"Found {matches} lines matching the pattern.")
    except FileNotFoundError:
        print(f"Log file not found: {logfile}")

if __name__ == "__main__":
    main()
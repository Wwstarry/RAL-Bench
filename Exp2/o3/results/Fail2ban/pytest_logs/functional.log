...F....F...                                                             [100%]
================================== FAILURES ===================================
________________ test_004_filter_core_symbols_exist_statically ________________

    def test_004_filter_core_symbols_exist_statically():
        """
        Do not assume helper names like isValidIP/searchIP (they vary across versions).
        Instead, require stable core anchors in fail2ban.server.filter:
          - A Filter class (or similarly named core filter object), OR
          - presence of key tokens that indicate regex-driven filtering (failregex/<HOST>).
        """
        filter_py = _pkg_dir() / "server" / "filter.py"
        src = _read_text(filter_py)
    
        has_filter_class = _ast_has_class(filter_py, "Filter") or ("class Filter" in src)
        has_regex_tokens = ("failregex" in src.lower()) or ("<host>" in src.lower())
    
>       assert has_filter_class or has_regex_tokens, "Expected core filter anchors (Filter class or failregex/<HOST> tokens)."
E       AssertionError: Expected core filter anchors (Filter class or failregex/<HOST> tokens).
E       assert (False or False)

tests\Fail2ban\functional_test.py:129: AssertionError
____________ test_009_import_filter_and_basic_behavior_if_possible ____________

    def test_009_import_filter_and_basic_behavior_if_possible():
        _prepend_import_path()
        try:
            from fail2ban.server import filter as f
        except ModuleNotFoundError as e:
            msg = str(e).lower()
            assert any(k in msg for k in ["pwd", "grp", "resource", "fcntl"]), f"Unexpected import failure: {e}"
            return
    
        # If import works, ensure the module exposes a core Filter-like object or regex constants.
        if hasattr(f, "Filter"):
            assert callable(getattr(f, "Filter"))
        else:
            src = _read_text(_pkg_dir() / "server" / "filter.py").lower()
>           assert ("failregex" in src) or ("<host>" in src)
E           assert ('failregex' in '"""\nfail2ban.server.filter\n======================\n\na *very* small helper module that offers the api surface requi...ier to locate.\n    m4 = _ipv4_re.search(text)\n    if m4:\n        return m4.group(0)\n\n    return _first_ipv6(text)' or '<host>' in '"""\nfail2ban.server.filter\n======================\n\na *very* small helper module that offers the api surface requi...ier to locate.\n    m4 = _ipv4_re.search(text)\n    if m4:\n        return m4.group(0)\n\n    return _first_ipv6(text)')

tests\Fail2ban\functional_test.py:187: AssertionError
=========================== short test summary info ===========================
FAILED tests/Fail2ban/functional_test.py::test_004_filter_core_symbols_exist_statically
FAILED tests/Fail2ban/functional_test.py::test_009_import_filter_and_basic_behavior_if_possible
2 failed, 10 passed in 1.26s

FFFFFF..F..F                                                             [100%]
================================== FAILURES ===================================
_________________________ test_001_package_dir_exists _________________________

    def test_001_package_dir_exists():
>       _pkg_dir()

tests\Fail2ban\functional_test.py:101: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

    def _pkg_dir() -> Path:
        base = _resolve_repo_root()
        pkg = base / "fail2ban"
>       assert pkg.is_dir(), f"Expected fail2ban package directory at: {pkg}"
E       AssertionError: Expected fail2ban package directory at: D:\桌面\RealAppCodeBench_generic_eval\generation\Fail2ban\fail2ban
E       assert False
E        +  where False = is_dir()
E        +    where is_dir = WindowsPath('D:/桌面/RealAppCodeBench_generic_eval/generation/Fail2ban/fail2ban').is_dir

tests\Fail2ban\functional_test.py:45: AssertionError
___________________ test_002_core_server_module_files_exist ___________________

    def test_002_core_server_module_files_exist():
>       pkg = _pkg_dir()

tests\Fail2ban\functional_test.py:105: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

    def _pkg_dir() -> Path:
        base = _resolve_repo_root()
        pkg = base / "fail2ban"
>       assert pkg.is_dir(), f"Expected fail2ban package directory at: {pkg}"
E       AssertionError: Expected fail2ban package directory at: D:\桌面\RealAppCodeBench_generic_eval\generation\Fail2ban\fail2ban
E       assert False
E        +  where False = is_dir()
E        +    where is_dir = WindowsPath('D:/桌面/RealAppCodeBench_generic_eval/generation/Fail2ban/fail2ban').is_dir

tests\Fail2ban\functional_test.py:45: AssertionError
____________________ test_003_jail_class_exists_statically ____________________

    def test_003_jail_class_exists_statically():
>       jail_py = _pkg_dir() / "server" / "jail.py"

tests\Fail2ban\functional_test.py:111: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

    def _pkg_dir() -> Path:
        base = _resolve_repo_root()
        pkg = base / "fail2ban"
>       assert pkg.is_dir(), f"Expected fail2ban package directory at: {pkg}"
E       AssertionError: Expected fail2ban package directory at: D:\桌面\RealAppCodeBench_generic_eval\generation\Fail2ban\fail2ban
E       assert False
E        +  where False = is_dir()
E        +    where is_dir = WindowsPath('D:/桌面/RealAppCodeBench_generic_eval/generation/Fail2ban/fail2ban').is_dir

tests\Fail2ban\functional_test.py:45: AssertionError
________________ test_004_filter_core_symbols_exist_statically ________________

    def test_004_filter_core_symbols_exist_statically():
        """
        Do not assume helper names like isValidIP/searchIP (they vary across versions).
        Instead, require stable core anchors in fail2ban.server.filter:
          - A Filter class (or similarly named core filter object), OR
          - presence of key tokens that indicate regex-driven filtering (failregex/<HOST>).
        """
>       filter_py = _pkg_dir() / "server" / "filter.py"

tests\Fail2ban\functional_test.py:123: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

    def _pkg_dir() -> Path:
        base = _resolve_repo_root()
        pkg = base / "fail2ban"
>       assert pkg.is_dir(), f"Expected fail2ban package directory at: {pkg}"
E       AssertionError: Expected fail2ban package directory at: D:\桌面\RealAppCodeBench_generic_eval\generation\Fail2ban\fail2ban
E       assert False
E        +  where False = is_dir()
E        +    where is_dir = WindowsPath('D:/桌面/RealAppCodeBench_generic_eval/generation/Fail2ban/fail2ban').is_dir

tests\Fail2ban\functional_test.py:45: AssertionError
______________________ test_005_config_jail_conf_exists _______________________

    def test_005_config_jail_conf_exists():
        base = _resolve_repo_root()
        cfg = base / "config" / "jail.conf"
>       assert cfg.is_file(), "Expected config/jail.conf to exist"
E       AssertionError: Expected config/jail.conf to exist
E       assert False
E        +  where False = is_file()
E        +    where is_file = WindowsPath('D:/桌面/RealAppCodeBench_generic_eval/generation/Fail2ban/config/jail.conf').is_file

tests\Fail2ban\functional_test.py:135: AssertionError
_________________________ test_006_bin_scripts_exist __________________________

    def test_006_bin_scripts_exist():
        base = _resolve_repo_root()
        b = base / "bin"
>       assert b.is_dir(), "Expected bin/ directory"
E       AssertionError: Expected bin/ directory
E       assert False
E        +  where False = is_dir()
E        +    where is_dir = WindowsPath('D:/桌面/RealAppCodeBench_generic_eval/generation/Fail2ban/bin').is_dir

tests\Fail2ban\functional_test.py:141: AssertionError
____________ test_009_import_filter_and_basic_behavior_if_possible ____________

    def test_009_import_filter_and_basic_behavior_if_possible():
        _prepend_import_path()
        try:
            from fail2ban.server import filter as f
        except ModuleNotFoundError as e:
            msg = str(e).lower()
            assert any(k in msg for k in ["pwd", "grp", "resource", "fcntl"]), f"Unexpected import failure: {e}"
            return
    
        # If import works, ensure the module exposes a core Filter-like object or regex constants.
        if hasattr(f, "Filter"):
            assert callable(getattr(f, "Filter"))
        else:
>           src = _read_text(_pkg_dir() / "server" / "filter.py").lower()

tests\Fail2ban\functional_test.py:186: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

    def _pkg_dir() -> Path:
        base = _resolve_repo_root()
        pkg = base / "fail2ban"
>       assert pkg.is_dir(), f"Expected fail2ban package directory at: {pkg}"
E       AssertionError: Expected fail2ban package directory at: D:\桌面\RealAppCodeBench_generic_eval\generation\Fail2ban\fail2ban
E       assert False
E        +  where False = is_dir()
E        +    where is_dir = WindowsPath('D:/桌面/RealAppCodeBench_generic_eval/generation/Fail2ban/fail2ban').is_dir

tests\Fail2ban\functional_test.py:45: AssertionError
___________ test_012_fail2ban_regex_matches_simple_pattern_offline ____________

    def test_012_fail2ban_regex_matches_simple_pattern_offline():
        """
        Offline-only functional check:
        - Create a temp log with repeated failure lines.
        - Run fail2ban-regex <LOG> <REGEX>
        - Assert output indicates it processed lines and found matches.
        """
        base = _resolve_repo_root()
        script = base / "bin" / "fail2ban-regex"
    
        env = os.environ.copy()
        env["PYTHONUNBUFFERED"] = "1"
        env["PYTHONPATH"] = str(_resolve_repo_root()) + (os.pathsep + env["PYTHONPATH"] if env.get("PYTHONPATH") else "")
    
        with tempfile.TemporaryDirectory(prefix="racb_fail2ban_") as td:
            logp = Path(td) / "auth.log"
            logp.write_text(
                "\n".join(
                    [
                        "Failed password for invalid user root from 203.0.113.5 port 2222 ssh2",
                        "Failed password for invalid user admin from 203.0.113.5 port 2223 ssh2",
                        "Accepted password for user ok from 198.51.100.2 port 3333 ssh2",
                        "Failed password for invalid user test from 203.0.113.9 port 4444 ssh2",
                    ]
                ),
                encoding="utf-8",
            )
    
            # Use a very simple regex (do not rely on <HOST> substitutions).
            regex = r"Failed password"
            p = subprocess.run(
                [sys.executable, str(script), str(logp), regex],
                text=True,
                input="",
                capture_output=True,
                timeout=30,
                env=env,
            )
            out = _out(p)
    
            # Must not hang; and should show it processed lines.
>           assert ("line" in out) or ("lines" in out)
E           assert ('line' in "\nc:\\users\\86152\\appdata\\local\\programs\\python\\python39\\python.exe: can't open file 'd:\\妗岄潰\\realappcodebench_generic_eval\\generation\\fail2ban\\bin\\fail2ban-regex': [errno 2] no such file or directory\n" or 'lines' in "\nc:\\users\\86152\\appdata\\local\\programs\\python\\python39\\python.exe: can't open file 'd:\\妗岄潰\\realappcodebench_generic_eval\\generation\\fail2ban\\bin\\fail2ban-regex': [errno 2] no such file or directory\n")

tests\Fail2ban\functional_test.py:246: AssertionError
=========================== short test summary info ===========================
FAILED tests/Fail2ban/functional_test.py::test_001_package_dir_exists - Asser...
FAILED tests/Fail2ban/functional_test.py::test_002_core_server_module_files_exist
FAILED tests/Fail2ban/functional_test.py::test_003_jail_class_exists_statically
FAILED tests/Fail2ban/functional_test.py::test_004_filter_core_symbols_exist_statically
FAILED tests/Fail2ban/functional_test.py::test_005_config_jail_conf_exists - ...
FAILED tests/Fail2ban/functional_test.py::test_006_bin_scripts_exist - Assert...
FAILED tests/Fail2ban/functional_test.py::test_009_import_filter_and_basic_behavior_if_possible
FAILED tests/Fail2ban/functional_test.py::test_012_fail2ban_regex_matches_simple_pattern_offline
8 failed, 4 passed in 1.28s
